{%- comment -%}
  AE Header für Autoschilder Express
  Depict-Style Layout: Logo links, Nav zentriert, CTA rechts, Cart links neben CTA
  Styles sind in base.css enthalten
{%- endcomment -%}

{{ 'ae-header.js' | asset_url | script_tag }}
{{ 'ae-mega-menu.js' | asset_url | script_tag }}

<header class="ae-header" role="banner">
  <div class="ae-header__container">
    
    {%- comment -%} Logo - Links (Depict.ai Style) {%- endcomment -%}
    <div class="ae-header__logo">
      <a href="{{ routes.root_url }}" class="ae-header__logo-link">
        {%- if section.settings.logo != blank -%}
          {{ section.settings.logo | image_url: width: 200 | image_tag:
            loading: 'eager',
            widths: '100, 150, 200',
            class: 'ae-header__logo-image',
            alt: shop.name
          }}
        {%- else -%}
          <span class="ae-header__logo-text">
            {%- if section.settings.logo_text != blank -%}
              {{ section.settings.logo_text }}
            {%- else -%}
              Autoschilder Express
            {%- endif -%}
          </span>
        {%- endif -%}
      </a>
    </div>

    {%- comment -%} Navigation - Dynamisches Mega-Menü {%- endcomment -%}
    <nav class="ae-header__nav" aria-label="Hauptnavigation">
      <ul class="ae-header__menu">
        {%- for link in linklists[section.settings.menu].links -%}
          <li class="ae-header__menu-item" data-mega-menu="{{ link.title | handle }}">
            <a href="{{ link.url }}" class="ae-header__menu-link" data-mega-menu-trigger>
              {{ link.title }}
              {%- if link.links != blank -%}
                <svg class="ae-header__menu-arrow" width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              {%- endif -%}
            </a>
            
            {%- comment -%} Dynamisches Mega-Menü basierend auf Shopify-Menü {%- endcomment -%}
            {%- if link.links != blank -%}
              <div class="ae-mega-menu" data-mega-menu-content>
                <div class="ae-mega-menu__container">
                  <div class="ae-mega-menu__grid">
                    
                    {%- comment -%} MongoDB-Style: 4 Hauptkategorien in der ersten Reihe {%- endcomment -%}
                    
                    {%- comment -%} 1. Spalte: Kfz-Kennzeichen {%- endcomment -%}
                    <div class="ae-mega-menu__column">
                      <h3 class="ae-mega-menu__heading">KFZ-KENNZEICHEN</h3>
                      <ul class="ae-mega-menu__list">
                        {%- for child_link in link.links -%}
                          {%- if child_link.title contains 'Kennzeichen' and child_link.title != 'Motorradkennzeichen' -%}
                            <li class="ae-mega-menu__item">
                              <a href="{{ child_link.url }}" class="ae-mega-menu__link">
                                {%- if child_link.title contains 'Wunschkennzeichen' -%}
                                  <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                    <path d="M7 15h10M7 11h4M7 7h2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                  </svg>
                                {%- elsif child_link.title contains 'E-Kennzeichen' -%}
                                  <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                    <path d="M8 12h8M8 8h4M8 16h2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                  </svg>
                                {%- elsif child_link.title contains 'Saison' -%}
                                  <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 8v4l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                  </svg>
                                {%- elsif child_link.title contains 'H-Kennzeichen' -%}
                                  <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                  </svg>
                                {%- else -%}
                                  <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                    <path d="M7 15h10M7 11h4M7 7h2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                  </svg>
                                {%- endif -%}
                                
                                <div class="ae-mega-menu__content">
                                  <span class="ae-mega-menu__title">{{ child_link.title }}</span>
                                  {%- if child_link.title contains 'Wunschkennzeichen' -%}
                                    <span class="ae-mega-menu__description">Ihr persönliches Kennzeichen online bestellen</span>
                                  {%- elsif child_link.title contains 'E-Kennzeichen' -%}
                                    <span class="ae-mega-menu__description">Elektro-Fahrzeuge kennzeichnen</span>
                                  {%- elsif child_link.title contains 'Saisonkennzeichen' -%}
                                    <span class="ae-mega-menu__description">Nur für bestimmte Monate im Jahr</span>
                                  {%- elsif child_link.title contains 'H-Kennzeichen' -%}
                                    <span class="ae-mega-menu__description">Für historische Fahrzeuge ab 30 Jahren</span>
                                  {%- else -%}
                                    <span class="ae-mega-menu__description">Professionelle Kfz-Kennzeichen</span>
                                  {%- endif -%}
                                </div>
                              </a>
                            </li>
                          {%- endif -%}
                        {%- endfor -%}
                      </ul>
                    </div>

                    {%- comment -%} 2. Spalte: Online Service {%- endcomment -%}
                    <div class="ae-mega-menu__column">
                      <h3 class="ae-mega-menu__heading">ONLINE SERVICE</h3>
                      <ul class="ae-mega-menu__list">
                        {%- for child_link in link.links -%}
                          {%- if child_link.title contains 'Zulassung' or child_link.title contains 'Abmeldung' or child_link.title contains 'Umschreibung' or child_link.title contains 'Adress' -%}
                            <li class="ae-mega-menu__item">
                              <a href="{{ child_link.url }}" class="ae-mega-menu__link">
                                {%- if child_link.title contains 'Zulassung' -%}
                                  <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3" stroke="currentColor" stroke-width="2"/>
                                  </svg>
                                {%- elsif child_link.title contains 'Abmeldung' -%}
                                  <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke="currentColor" stroke-width="2"/>
                                    <polyline points="16,17 21,12 16,7" stroke="currentColor" stroke-width="2"/>
                                    <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2"/>
                                  </svg>
                                {%- elsif child_link.title contains 'Umschreibung' -%}
                                  <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
                                    <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
                                    <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
                                    <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2"/>
                                  </svg>
                                {%- else -%}
                                  <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1" stroke="currentColor" stroke-width="2"/>
                                  </svg>
                                {%- endif -%}
                                
                                <div class="ae-mega-menu__content">
                                  <span class="ae-mega-menu__title">{{ child_link.title }}</span>
                                  {%- if child_link.title contains 'Zulassung' -%}
                                    <span class="ae-mega-menu__description">Vollständige Kfz-Zulassung online</span>
                                  {%- elsif child_link.title contains 'Abmeldung' -%}
                                    <span class="ae-mega-menu__description">Fahrzeug abmelden und Kennzeichen zurückgeben</span>
                                  {%- elsif child_link.title contains 'Umschreibung' -%}
                                    <span class="ae-mega-menu__description">Fahrzeug auf neuen Halter umschreiben</span>
                                  {%- elsif child_link.title contains 'Adress' -%}
                                    <span class="ae-mega-menu__description">Adress- oder Namensänderung bei Fahrzeug</span>
                                  {%- else -%}
                                    <span class="ae-mega-menu__description">Online Service verfügbar</span>
                                  {%- endif -%}
                                </div>
                              </a>
                            </li>
                          {%- endif -%}
                        {%- endfor -%}
                      </ul>
                    </div>

                    {%- comment -%} 3. Spalte: Versicherungen {%- endcomment -%}
                    <div class="ae-mega-menu__column">
                      <h3 class="ae-mega-menu__heading">VERSICHERUNGEN</h3>
                      <ul class="ae-mega-menu__list">
                        {%- for child_link in link.links -%}
                          {%- if child_link.title contains 'Versicherung' -%}
                            <li class="ae-mega-menu__item">
                              <a href="{{ child_link.url }}" class="ae-mega-menu__link">
                                <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <div class="ae-mega-menu__content">
                                  <span class="ae-mega-menu__title">{{ child_link.title }}</span>
                                  <span class="ae-mega-menu__description">Passende Versicherung für Ihr Fahrzeug</span>
                                </div>
                              </a>
                            </li>
                          {%- endif -%}
                        {%- endfor -%}
                      </ul>
                    </div>

                    {%- comment -%} 4. Spalte: Motorrad {%- endcomment -%}
                    <div class="ae-mega-menu__column">
                      <h3 class="ae-mega-menu__heading">MOTORRAD</h3>
                      <ul class="ae-mega-menu__list">
                        {%- for child_link in link.links -%}
                          {%- if child_link.title contains 'Motorrad' -%}
                            <li class="ae-mega-menu__item">
                              <a href="{{ child_link.url }}" class="ae-mega-menu__link">
                                <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                  <path d="M18 15v-3a3 3 0 0 0-6 0v3M6 15v-3a3 3 0 0 1 6 0v3M6 15h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                  <circle cx="8" cy="15" r="2"/>
                                  <circle cx="16" cy="15" r="2"/>
                                </svg>
                                <div class="ae-mega-menu__content">
                                  <span class="ae-mega-menu__title">{{ child_link.title }}</span>
                                  <span class="ae-mega-menu__description">Kompakte Kennzeichen für Zweiräder</span>
                                </div>
                              </a>
                            </li>
                          {%- endif -%}
                        {%- endfor -%}
                      </ul>
                    </div>

                    {%- comment -%} 5. Spalte: Zubehör {%- endcomment -%}
                    <div class="ae-mega-menu__column">
                      <h3 class="ae-mega-menu__heading">ZUBEHÖR</h3>
                      <ul class="ae-mega-menu__list">
                        {%- for child_link in link.links -%}
                          {%- if child_link.title contains 'Zubehör' -%}
                            <li class="ae-mega-menu__item">
                              <a href="{{ child_link.url }}" class="ae-mega-menu__link">
                                <svg class="ae-mega-menu__icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                  <rect x="2" y="3" width="20" height="14" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                                  <line x1="8" y1="21" x2="16" y2="21" stroke="currentColor" stroke-width="2"/>
                                  <line x1="12" y1="17" x2="12" y2="21" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <div class="ae-mega-menu__content">
                                  <span class="ae-mega-menu__title">{{ child_link.title }}</span>
                                  <span class="ae-mega-menu__description">Rahmen, Halter und Zubehör für Kennzeichen</span>
                                </div>
                              </a>
                            </li>
                          {%- endif -%}
                        {%- endfor -%}
                      </ul>
                    </div>
                    
                    {%- comment -%} CTA-Spalte für spezielle Menüs {%- endcomment -%}
                    {%- if link.title == 'Produkte' -%}
                      <div class="ae-mega-menu__column ae-mega-menu__column--cta">
                        <div class="ae-mega-menu__promo">
                          <h3 class="ae-mega-menu__promo-title">Zulassung starten</h3>
                          <p class="ae-mega-menu__promo-text">Vollständige Kfz-Zulassung in wenigen Minuten online abschließen</p>
                          <a href="/pages/zulassung" class="ae-mega-menu__promo-cta">Jetzt starten</a>
                        </div>
                        
                        <div class="ae-mega-menu__promo">
                          <h3 class="ae-mega-menu__promo-title">Express Service</h3>
                          <p class="ae-mega-menu__promo-text">Bearbeitung in 24h - perfekt für eilige Fälle</p>
                          <a href="/pages/express-service" class="ae-mega-menu__promo-cta">Mehr erfahren</a>
                        </div>
                      </div>
                    {%- endif -%}
                    
                  </div>
                </div>
              </div>
            {%- endif -%}
          </li>
        {%- endfor -%}
      </ul>
    </nav>

    {%- comment -%} Mobile Burger Menu - Nur auf Mobile sichtbar {%- endcomment -%}
    <button class="ae-header__burger" aria-label="Menü öffnen" data-mobile-menu-toggle>
      <span class="ae-header__burger-line"></span>
      <span class="ae-header__burger-line"></span>
      <span class="ae-header__burger-line"></span>
    </button>

    {%- comment -%} Actions - Rechts (Login + Cart + CTA) {%- endcomment -%}
    <div class="ae-header__actions">
      {%- comment -%} Login Icon {%- endcomment -%}
      <a href="{{ routes.account_login_url }}" class="ae-header__login" aria-label="Anmelden">
        <svg class="ae-header__login-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
      
      {%- comment -%} Cart Icon {%- endcomment -%}
      <a href="{{ routes.cart_url }}" class="ae-header__cart" aria-label="Warenkorb">
        <svg class="ae-header__cart-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M9 2L7 6H3v14h18V6h-4l-2-4H9z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M9 10v4m6-4v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="ae-header__cart-count">{{ cart.item_count }}</span>
      </a>
      
      {%- comment -%} CTA - Ganz rechts {%- endcomment -%}
      {%- if section.settings.cta_text != blank -%}
        <a href="{{ section.settings.cta_link }}" class="ae-header__cta">
          {{ section.settings.cta_text }}
        </a>
      {%- endif -%}
    </div>

    {%- comment -%} Mobile Navigation Menu - Overlay {%- endcomment -%}
    <div class="ae-header__mobile-menu" data-mobile-menu>
      <div class="ae-header__mobile-menu-content">
        <button class="ae-header__mobile-menu-close" aria-label="Menü schließen" data-mobile-menu-close>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
        
        <nav class="ae-header__mobile-nav" aria-label="Mobile Navigation">
          <ul class="ae-header__mobile-menu-list">
            {%- for link in linklists[section.settings.menu].links -%}
              <li class="ae-header__mobile-menu-item">
                <a href="{{ link.url }}" class="ae-header__mobile-menu-link">
                  {{ link.title }}
                </a>
              </li>
            {%- endfor -%}
          </ul>
        </nav>
      </div>
    </div>
    
  </div>
</header>

{% schema %}
{
  "name": "AE Header",
  "tag": "header",
  "class": "section-header",
  "settings": [
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Bild"
    },
    {
      "type": "text",
      "id": "logo_text",
      "label": "Logo Text (falls kein Bild)",
      "default": "Autoschilder Express"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menü",
      "default": "main-menu"
    },
    {
      "type": "header",
      "content": "Call-to-Action"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Text",
      "default": "Zulassung starten"
    },
    {
      "type": "url",
      "id": "cta_link",
      "label": "CTA Link"
    }
  ]
}
{% endschema %}
